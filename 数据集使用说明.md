# æ•°æ®é›†ä½¿ç”¨è¯´æ˜ - éªŒè¯é›†ä¿®å¤

## âš ï¸ é‡è¦ä¿®å¤

**é—®é¢˜**: åŸå§‹ä»£ç åœ¨è®­ç»ƒæ—¶ä½¿ç”¨æµ‹è¯•é›†(test)è¿›è¡ŒéªŒè¯ï¼Œè¿™æ˜¯ä¸¥é‡çš„é”™è¯¯ï¼

**è§£å†³æ–¹æ¡ˆ**: ä¿®æ”¹ä»£ç ä½¿ç”¨æ­£ç¡®çš„éªŒè¯é›†(dev)è¿›è¡Œè®­ç»ƒéªŒè¯ã€‚

---

## ğŸ“Š æ•°æ®é›†åˆ’åˆ†

### æ­£ç¡®çš„æ•°æ®é›†ä½¿ç”¨æ–¹å¼

```
WebQæ•°æ®é›† (å…±3ä¸ªéƒ¨åˆ†)
â”‚
â”œâ”€â”€ è®­ç»ƒé›† (train)
â”‚   â””â”€â”€ ç”¨äº: æ¨¡å‹è®­ç»ƒ âœ…
â”‚   â””â”€â”€ æ–‡ä»¶: datas/webq-train.json
â”‚   â””â”€â”€ å¤„ç†å: processed/train_triples.tsv
â”‚
â”œâ”€â”€ éªŒè¯é›† (dev) â­ é‡è¦
â”‚   â””â”€â”€ ç”¨äº: è®­ç»ƒæ—¶çš„æ¨¡å‹éªŒè¯ã€è¶…å‚æ•°è°ƒä¼˜ âœ…
â”‚   â””â”€â”€ æ–‡ä»¶: datas/webq-dev.json
â”‚   â””â”€â”€ å¤„ç†å: processed/dev/dev_questions.pkl, dev_answers.pkl
â”‚   â””â”€â”€ æ ·æœ¬æ•°: 278ä¸ªé—®é¢˜
â”‚
â””â”€â”€ æµ‹è¯•é›† (test)
    â””â”€â”€ ç”¨äº: æœ€ç»ˆæ¨¡å‹è¯„ä¼°ï¼ˆä»…è®­ç»ƒå®Œæˆåä½¿ç”¨ä¸€æ¬¡ï¼‰âš ï¸
    â””â”€â”€ æ–‡ä»¶: datas/webq-test.csv
    â””â”€â”€ å¤„ç†å: processed/test_questions.pkl, test_answers.pkl
    â””â”€â”€ æ ·æœ¬æ•°: ~200ä¸ªé—®é¢˜
    â””â”€â”€ ç¦æ­¢: è®­ç»ƒæ—¶ä¸¥ç¦ä½¿ç”¨ï¼âŒ
```

---

## ğŸ”§ ä»£ç ä¿®æ”¹è¯¦æƒ…

### 1. preprocess_data.py ä¿®æ”¹

**æ–°å¢å‡½æ•°**: `process_webq_dev_json()`
```python
def process_webq_dev_json(json_path: str, output_dir: str):
    """å¤„ç†WebQéªŒè¯æ•°æ®ï¼ˆä»JSONæ ¼å¼ï¼‰"""
    data = load_json(json_path)
    questions = []
    answers_list = []

    for item in data:
        question = item.get('question', '')
        answers = item.get('answers', [])
        if question and answers:
            questions.append(question)
            answers_list.append(answers)

    # ä¿å­˜åˆ° processed/dev/ ç›®å½•
    ...
```

**ä¿®æ”¹ä¸»å‡½æ•°**:
```python
# åŸæ¥ï¼ˆé”™è¯¯ï¼‰:
process_webq_dev(test_csv, dev_output_dir)  # ç”¨testæ•°æ®åˆ›å»ºdev âŒ

# ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰:
process_webq_dev_json(dev_json, dev_output_dir)  # ç”¨webq-dev.json âœ…
```

### 2. train_simple.py ä¿®æ”¹

**ä¿®æ”¹éªŒè¯é€»è¾‘**:
```python
# åŸæ¥ï¼ˆé”™è¯¯ï¼‰:
with open('processed/test_questions.pkl', 'rb') as f:  # ä½¿ç”¨test âŒ
    test_questions = pickle.load(f)[:100]

# ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰:
with open('processed/dev/dev_questions.pkl', 'rb') as f:  # ä½¿ç”¨dev âœ…
    dev_questions = pickle.load(f)
```

**æ·»åŠ é”™è¯¯å¤„ç†**:
```python
try:
    with open('processed/dev/dev_questions.pkl', 'rb') as f:
        dev_questions = pickle.load(f)
    print(f"Using dev set from processed/dev/ ({len(dev_questions)} samples)")
except FileNotFoundError:
    print("âš ï¸  Warning: Dev set not found in processed/dev/")
    print("   Please run: python preprocess_data.py")
    print("   Skipping validation for this epoch.")
    continue
```

---

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### Step 1: é‡æ–°é¢„å¤„ç†æ•°æ®

```bash
cd /ssd/tanyuqiao/IR_Project-main/data/IR_2025_Project
python preprocess_data.py
```

**è¾“å‡º**:
```
Processing WebQ dev data from .../datas/webq-dev.json...
Saved 278 dev questions to processed/dev/

============================================================
æ•°æ®é¢„å¤„ç†å®Œæˆï¼
============================================================

æ•°æ®é›†è¯´æ˜:
  - è®­ç»ƒé›†: processed/train_triples.tsv
  - éªŒè¯é›†: processed/dev/ (ç”¨äºæ¨¡å‹é€‰æ‹©å’Œè¶…å‚æ•°è°ƒä¼˜)
  - æµ‹è¯•é›†: processed/test_*.pkl (ä»…ç”¨äºæœ€ç»ˆè¯„ä¼°ï¼Œè®­ç»ƒæ—¶ä¸å¯ä½¿ç”¨)

âš ï¸  é‡è¦æç¤º:
  è®­ç»ƒæ—¶åªèƒ½ä½¿ç”¨éªŒè¯é›†(dev)è¿›è¡ŒéªŒè¯ï¼Œä¸¥ç¦ä½¿ç”¨æµ‹è¯•é›†(test)ï¼
============================================================
```

### Step 2: è®­ç»ƒæ¨¡å‹ï¼ˆè‡ªåŠ¨ä½¿ç”¨éªŒè¯é›†ï¼‰

```bash
python train_simple.py
```

**è®­ç»ƒæ—¥å¿—**:
```
Epoch 1/5
Training: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| xxx/xxx [xx:xx<00:00, loss=0.xxxx]

Validating on dev set...
Using dev set from processed/dev/ (278 samples)  âœ… æ­£ç¡®ä½¿ç”¨dev
Encoding passages...
Retrieving...
Validation - Hit@1: 0.xxxx, Hit@10: 0.xxxx, Hit@100: 0.xxxx
âœ“ Saved best model with Hit@10: 0.xxxx
```

### Step 3: æœ€ç»ˆæµ‹è¯•ï¼ˆä»…åœ¨è®­ç»ƒå®Œæˆåï¼‰

```bash
python test_simple.py
```

**è¿™æ‰æ˜¯æ­£ç¡®ä½¿ç”¨æµ‹è¯•é›†çš„æ—¶æœºï¼**

---

## ğŸ“‹ æ•°æ®é›†æ–‡ä»¶æ¸…å•

### å¤„ç†åçš„æ–‡ä»¶ç»“æ„
```
processed/
â”œâ”€â”€ passages.pkl                    # è¯­æ–™åº“
â”œâ”€â”€ train_triples.tsv               # è®­ç»ƒä¸‰å…ƒç»„
â”œâ”€â”€ train_triples_qa.pkl            # è®­ç»ƒQAæ˜ å°„
â”‚
â”œâ”€â”€ dev/                            # éªŒè¯é›† â­
â”‚   â”œâ”€â”€ dev_questions.pkl           # 278ä¸ªéªŒè¯é—®é¢˜
â”‚   â””â”€â”€ dev_answers.pkl             # å¯¹åº”ç­”æ¡ˆ
â”‚
â””â”€â”€ test_*.pkl                      # æµ‹è¯•é›† âš ï¸
    â”œâ”€â”€ test_questions.pkl          # ~200ä¸ªæµ‹è¯•é—®é¢˜
    â””â”€â”€ test_answers.pkl            # å¯¹åº”ç­”æ¡ˆ
```

### åŸå§‹æ•°æ®æ–‡ä»¶
```
datas/
â”œâ”€â”€ webq-train.json                 # è®­ç»ƒæ•°æ®
â”œâ”€â”€ webq-dev.json                   # éªŒè¯æ•°æ® â­
â””â”€â”€ webq-test.csv                   # æµ‹è¯•æ•°æ®
```

---

## âœ… éªŒè¯æ­£ç¡®æ€§

### æ£€æŸ¥1: éªŒè¯é›†æ˜¯å¦å­˜åœ¨
```bash
ls -lh processed/dev/
```

**æœŸæœ›è¾“å‡º**:
```
dev_questions.pkl  (~8KB)
dev_answers.pkl    (~9KB)
```

### æ£€æŸ¥2: éªŒè¯é›†æ•°é‡
```python
import pickle

with open('processed/dev/dev_questions.pkl', 'rb') as f:
    questions = pickle.load(f)
print(f"Dev set size: {len(questions)}")
```

**æœŸæœ›è¾“å‡º**: `Dev set size: 278`

### æ£€æŸ¥3: è®­ç»ƒæ—¶æ˜¯å¦ä½¿ç”¨éªŒè¯é›†
è®­ç»ƒæ—¥å¿—åº”è¯¥æ˜¾ç¤º:
```
Using dev set from processed/dev/ (278 samples)
```

è€Œä¸æ˜¯:
```
âš ï¸  Warning: Dev set not found...
```

---

## ğŸ¯ å…³é”®åŸåˆ™

### âœ… æ­£ç¡®åšæ³•
1. **è®­ç»ƒæ—¶**: ä½¿ç”¨è®­ç»ƒé›†(train)è®­ç»ƒï¼Œä½¿ç”¨éªŒè¯é›†(dev)éªŒè¯
2. **è¶…å‚æ•°è°ƒä¼˜**: ä½¿ç”¨éªŒè¯é›†(dev)æ¯”è¾ƒä¸åŒé…ç½®
3. **æ¨¡å‹é€‰æ‹©**: ä¿å­˜éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹
4. **æœ€ç»ˆè¯„ä¼°**: è®­ç»ƒå…¨éƒ¨å®Œæˆåï¼Œåœ¨æµ‹è¯•é›†(test)ä¸Šè¯„ä¼°ä¸€æ¬¡

### âŒ é”™è¯¯åšæ³•
1. ~~åœ¨è®­ç»ƒæ—¶ä½¿ç”¨æµ‹è¯•é›†éªŒè¯~~ï¼ˆä¼šå¯¼è‡´æ•°æ®æ³„éœ²ï¼‰
2. ~~æ ¹æ®æµ‹è¯•é›†ç»“æœè°ƒæ•´è¶…å‚æ•°~~ï¼ˆä¼šå¯¼è‡´è¿‡æ‹Ÿåˆï¼‰
3. ~~å¤šæ¬¡åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°å¹¶é€‰æ‹©æ¨¡å‹~~ï¼ˆä¼šå¯¼è‡´æµ‹è¯•é›†æ— æ•ˆï¼‰
4. ~~å°†æµ‹è¯•é›†ç”¨äºä»»ä½•è®­ç»ƒç›¸å…³çš„å†³ç­–~~ï¼ˆè¿åå­¦æœ¯è§„èŒƒï¼‰

---

## ğŸ“š ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼Ÿ

### 1. ç§‘å­¦æ€§
- æµ‹è¯•é›†åº”è¯¥æ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼ˆä»æœªè§è¿‡çš„æ•°æ®ï¼‰
- å¦‚æœåœ¨è®­ç»ƒæ—¶ä½¿ç”¨äº†æµ‹è¯•é›†ï¼Œå°±æ— æ³•çœŸå®è¯„ä¼°æ³›åŒ–èƒ½åŠ›

### 2. å…¬å¹³æ€§
- æ‰€æœ‰æ¨¡å‹åº”è¯¥åœ¨ç›¸åŒçš„æ¡ä»¶ä¸‹æ¯”è¾ƒ
- ä¸èƒ½é’ˆå¯¹æµ‹è¯•é›†"åˆ·åˆ†"

### 3. å­¦æœ¯è§„èŒƒ
- æœºå™¨å­¦ä¹ ç ”ç©¶çš„åŸºæœ¬è¦æ±‚
- è¿åå¯èƒ½å¯¼è‡´è®ºæ–‡è¢«æ‹’ç¨¿

### 4. å®é™…åº”ç”¨
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ¨¡å‹ä¼šé‡åˆ°è®­ç»ƒæ—¶ä»æœªè§è¿‡çš„æ•°æ®
- æµ‹è¯•é›†å°±æ˜¯ä¸ºäº†æ¨¡æ‹Ÿè¿™ç§æƒ…å†µ

---

## ğŸ” ä»£ç å®¡æŸ¥æ¸…å•

åœ¨æäº¤å®éªŒæŠ¥å‘Šå‰ï¼Œè¯·ç¡®è®¤:

- [ ] `preprocess_data.py` å·²æ›´æ–°ï¼Œä½¿ç”¨`webq-dev.json`åˆ›å»ºéªŒè¯é›†
- [ ] `train_simple.py` ä½¿ç”¨`processed/dev/`è¿›è¡ŒéªŒè¯
- [ ] è®­ç»ƒæ—¥å¿—æ˜¾ç¤º"Using dev set from processed/dev/"
- [ ] ä»æœªåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨`test_questions.pkl`æˆ–`test_answers.pkl`
- [ ] ä»…åœ¨è®­ç»ƒå®Œå…¨ç»“æŸåè¿è¡Œä¸€æ¬¡`test_simple.py`
- [ ] å®éªŒæŠ¥å‘Šä¸­æ˜ç¡®è¯´æ˜ä½¿ç”¨äº†éªŒè¯é›†è¿›è¡Œæ¨¡å‹é€‰æ‹©

---

## ğŸ“– å‚è€ƒèµ„æ–™

### æœºå™¨å­¦ä¹ åŸºç¡€
- "Machine Learning" by Tom Mitchell - Chapter on Model Evaluation
- "Deep Learning" by Goodfellow et al. - Section on Validation Sets

### å­¦æœ¯è§„èŒƒ
- ICLR/NeurIPS Reviewer Guidelines - Data Splitting Requirements
- Kaggle Competitions - Data Leakage Prevention

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸èƒ½åœ¨è®­ç»ƒæ—¶ç”¨æµ‹è¯•é›†ï¼Ÿ
**A**: è¿™ä¼šå¯¼è‡´æ•°æ®æ³„éœ²ï¼ˆdata leakageï¼‰ï¼Œä½¿å¾—æµ‹è¯•ç»“æœæ— æ³•åæ˜ æ¨¡å‹çš„çœŸå®æ€§èƒ½ã€‚

### Q2: éªŒè¯é›†å’Œæµ‹è¯•é›†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A**:
- **éªŒè¯é›†**: ç”¨äºè®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¨¡å‹é€‰æ‹©å’Œè¶…å‚æ•°è°ƒä¼˜
- **æµ‹è¯•é›†**: ä»…ç”¨äºæœ€ç»ˆè¯„ä¼°ï¼Œæ¨¡æ‹ŸçœŸå®åº”ç”¨åœºæ™¯

### Q3: å¦‚æœæ²¡æœ‰éªŒè¯é›†æ€ä¹ˆåŠï¼Ÿ
**A**: å¯ä»¥ä»è®­ç»ƒé›†ä¸­åˆ’åˆ†ä¸€éƒ¨åˆ†ä½œä¸ºéªŒè¯é›†ï¼ˆä¾‹å¦‚80%è®­ç»ƒï¼Œ20%éªŒè¯ï¼‰ã€‚

### Q4: ä¿®å¤åæ€§èƒ½ä¸‹é™äº†å—ï¼Ÿ
**A**: è¿™æ˜¯æ­£å¸¸çš„ï¼ä¹‹å‰çš„"æ€§èƒ½"å¯èƒ½æ˜¯è¿‡æ‹Ÿåˆæµ‹è¯•é›†çš„ç»“æœã€‚ç°åœ¨ä½¿ç”¨éªŒè¯é›†çš„ç»“æœæ‰æ˜¯å¯é çš„ã€‚

---

## âœ¨ æ€»ç»“

è¿™æ¬¡ä¿®å¤ç¡®ä¿äº†å®éªŒçš„**ç§‘å­¦æ€§**å’Œ**è§„èŒƒæ€§**:

1. âœ… ä½¿ç”¨æ­£ç¡®çš„éªŒè¯é›†è¿›è¡Œæ¨¡å‹éªŒè¯
2. âœ… æµ‹è¯•é›†ä»…ç”¨äºæœ€ç»ˆè¯„ä¼°
3. âœ… ç¬¦åˆæœºå™¨å­¦ä¹ ç ”ç©¶çš„åŸºæœ¬è§„èŒƒ
4. âœ… ç»“æœçœŸå®å¯é 

**è®°ä½**: æµ‹è¯•é›†å°±åƒè€ƒè¯•ï¼Œå¹³æ—¶ç»ƒä¹ ï¼ˆè®­ç»ƒ+éªŒè¯ï¼‰æ—¶ä¸èƒ½çœ‹è€ƒè¯•é¢˜ï¼

---

ä¿®å¤æ—¥æœŸ: 2024-12-25
ä¿®å¤å†…å®¹: ä¿®æ­£æ•°æ®é›†ä½¿ç”¨è§„èŒƒï¼Œç¡®ä¿è®­ç»ƒæ—¶ä½¿ç”¨éªŒè¯é›†è€Œéæµ‹è¯•é›†
